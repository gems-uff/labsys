<div class="page-header">
    <h1>
      Estoque de Reativos
    </h1>
</div>
<table class="table table-striped table-bordered">
  <thead>
    <tr>
      <th width="40%">Reativo</th>
      <th width="20%">Fabricante</th>
      <th width="10%">Quantidade em Estoque</th>
      <th width="10%">Estoque Mínimo</th>
    </tr>
  </thead>
  <tbody>
    {% for product in products %}
      <tr>
        <td>
          <a data-toggle="collapse" href="#collapseStockProducts-{{loop.index}}" aria-expanded="false" aria-controls="collapseStockProducts">
            ({{ product.catalog }}) {{ product.name }}
          </a>
        </td>
        <td>{{ product.manufacturer }}</td>
        <td {% if product.aggregate_amount < product.min_stock %} class="danger" title="Estoque abaixo do mínimo"{% endif %}>
            {{ product.aggregate_amount }}
        </td>
        <td>{{ product.min_stock }}</td>
      </tr>
      {% if product.aggregate_amount > 0 %}
        <tr class="collapse" id="collapseStockProducts-{{loop.index}}"><td><table class="table table-striped table-bordered">
          <thead>
            <tr>
              <th>Lote</th>
              <th>Quantidade em estoque</th>
              <th>Data de validade</th>
            </tr>
          </thead>
          <tbody>
            {% for stock_product in product.stock_products %}
              {% if stock_product.amount > 0 %}
                <tr>
                  <td>{{ stock_product.lot_number }}</td>
                  <td>{{ stock_product.amount }}</td>
                  <td>{{ stock_product.expiration_date }}</td>
                </tr>
              {% endif %}
            {% endfor %}
          </tbody>
        </table></td></tr>
      {% endif %}
      </div>
    {% endfor %}
  </tbody>
</table>
